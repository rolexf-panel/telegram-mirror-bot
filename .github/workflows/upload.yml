name: File Upload Handler

on:
  workflow_dispatch:
    inputs:
      session_id:
        description: 'Upload session ID'
        required: true
      service:
        description: 'Upload service (pixeldrain, gofile, catbox, etc)'
        required: true
      workflow_data:
        description: 'JSON workflow data'
        required: true

jobs:
  upload:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          pip install telethon requests aiohttp python-telegram-bot
      
      - name: Download and Upload Files
        env:
          SESSION_ID: ${{ github.event.inputs.session_id }}
          SERVICE: ${{ github.event.inputs.service }}
          WORKFLOW_DATA: ${{ github.event.inputs.workflow_data }}
          TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
          TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
          TELEGRAM_STRING_SESSION: ${{ secrets.TELEGRAM_STRING_SESSION }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          PIXELDRAIN_API_KEY: ${{ secrets.PIXELDRAIN_API_KEY }}
          GOFILE_API_KEY: ${{ secrets.GOFILE_API_KEY }}
          CATBOX_USER_HASH: ${{ secrets.CATBOX_USER_HASH }}
        run: |
          python workflow_handler.py
      
      - name: Cleanup
        if: always()
        run: |
          rm -rf downloads/*
          rm -rf temp/*
